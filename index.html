<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Simulación ETF VOO</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial; background: #f2f2f2; margin: 0; text-align: center; }
    header { background: #800000; color: white; padding: 15px 0; }
    .chart-container { width: 100%; max-width: 1200px; margin: auto; }
    #chart { height: 600px; }
    #signal-board {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 30px auto;
      gap: 15px;
      max-width: 1200px;
    }
    .signal-card {
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      min-width: 120px;
      font-size: 16px;
      white-space: pre-line;
    }
    footer {
      margin-top: 40px;
      font-size: 12px;
      color: gray;
    }
  </style>
</head>
<body>
  <header>
    <h1>Simulación Dinámica ETF VOO</h1>
  </header>

  <div class="chart-container">
    <div id="chart"></div>
  </div>

  <div id="signal-board"></div>

  <footer>© 2025 Visualización académica</footer>

  <script>
    const signalIndicators = [
      'RSI_14', 'MACD_12_26_9', 'EMA_10', 'EMA_50', 'EMA_200',
      'SMA_10', 'SMA_50', 'SMA_200', 'VWMA_20',
      'ADX_14', 'CCI_20', 'Momentum_10', 'Ultimate_Oscillator',
      'Ichimoku_Base', 'Stochastic_K'
    ];

    const indicatorHeaders = {};
    let ohlcData = [];
    let currentStep = 0;

    function colorBySignal(signal) {
      switch (signal) {
        case 'Buy': return '#28a745';     // Verde
        case 'Sell': return '#dc3545';    // Rojo
        case 'Neutral': return '#6c757d'; // Gris
        default: return '#999999';        // Desconocido
      }
    }

    function showSignalBoard(row) {
      const board = document.getElementById('signal-board');
      board.innerHTML = '';

      signalIndicators.forEach(ind => {
        const i = indicatorHeaders[ind];
        if (i !== undefined && row[i]) {
          const signal = row[i];
          const color = colorBySignal(signal);
          const div = document.createElement('div');
          div.className = 'signal-card';
          div.style.background = color;
          div.innerText = `${ind.replace(/_/g, ' ')}\n${signal}`;
          board.appendChild(div);
        }
      });
    }

    function updateChart(step) {
      const datetime = [], open = [], high = [], low = [], close = [];
      for (let i = 0; i <= step; i++) {
        const row = ohlcData[i];
        datetime.push(row[0]);
        open.push(+row[1]);
        high.push(+row[2]);
        low.push(+row[3]);
        close.push(+row[4]);
      }

      const trace = {
        x: datetime,
        open: open,
        high: high,
        low: low,
        close: close,
        type: 'candlestick',
        name: 'Precio VOO',
        increasing: { line: { color: 'green' } },
        decreasing: { line: { color: 'red' } }
      };

      const layout = {
        title: 'Precio del ETF VOO',
        xaxis: { title: 'Tiempo', rangeslider: { visible: false } },
        yaxis: { title: 'Precio' },
        margin: { t: 40 }
      };

      Plotly.newPlot('chart', [trace], layout);
    }

    fetch('ohlc.csv')
      .then(response => response.text())
      .then(text => {
        const rows = text.trim().split('\n');
        const headers = rows[0].split(',');
        ohlcData = rows.slice(1).map(r => r.split(','));

        signalIndicators.forEach(ind => {
          indicatorHeaders[ind] = headers.indexOf(ind);
        });

        simulate();
      });

    function simulate() {
      function stepForward() {
        if (currentStep >= ohlcData.length) return;
        updateChart(currentStep);
        showSignalBoard(ohlcData[currentStep]);
        currentStep++;
        setTimeout(stepForward, 400);
      }
      stepForward();
    }
  </script>
</body>
</html>