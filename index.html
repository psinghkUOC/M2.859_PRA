<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vanguard S&P 500 ETF - Visualización Dinámica</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background: #f7f8fa;
            text-align: center;
        }

        header {
            background-color: #800000;
            color: white;
            padding: 10px;
        }

        #chart {
            margin: 20px;
        }

        #gauges-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .toggle-btn {
            margin: 10px;
            padding: 10px 20px;
            background-color: #2d66f7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        footer {
            margin-top: 40px;
            font-size: 12px;
            color: gray;
        }
    </style>
</head>
<body>
    <header>
        <h1>Vanguard S&P 500 ETF - Visualización Dinámica</h1>
    </header>

    <div id="chart"></div>

    <button class="toggle-btn" onclick="toggleGauges()">Mostrar/Ocultar Indicadores</button>
    <div id="gauges-container" style="display: none;"></div>

    <footer>© 2025 Visualización desarrollada como proyecto académico</footer>

    <script>
        const indicadores = ['RSI_14', 'ADX_14', 'CCI_20', 'Momentum_10', 'Stochastic_K', 'Ultimate_Oscillator'];
        let gaugesVisible = false;

        function crearGauge(titulo, valor, contenedorID) {
            const data = [{
                type: "indicator",
                mode: "gauge+number",
                value: valor,
                title: { text: titulo, font: { size: 14 } },
                gauge: {
                    axis: { range: [0, 30] },
                    steps: [
                        { range: [0, 10], color: "#f28e8e" },
                        { range: [10, 20], color: "#f3f3a6" },
                        { range: [20, 30], color: "#a6f3b8" }
                    ]
                }
            }];

            const layout = { width: 200, height: 180, margin: { t: 30, b: 0 } };
            Plotly.newPlot(contenedorID, data, layout);
        }

        function toggleGauges() {
            const contenedor = document.getElementById('gauges-container');
            if (gaugesVisible) {
                contenedor.style.display = 'none';
                gaugesVisible = false;
            } else {
                contenedor.innerHTML = '';
                fetch('ohlc.csv')
                    .then(response => response.text())
                    .then(text => {
                        const rows = text.trim().split('\n');
                        const headers = rows[0].split(',');
                        const lastRow = rows[rows.length - 1].split(',');

                        indicadores.forEach(ind => {
                            const i = headers.indexOf(ind);
                            if (i !== -1 && lastRow[i] !== '' && !isNaN(lastRow[i])) {
                                const valor = parseFloat(lastRow[i]);
                                const div = document.createElement('div');
                                const id = `gauge-${ind}`;
                                div.id = id;
                                document.getElementById('gauges-container').appendChild(div);
                                crearGauge(ind.replace(/_/g, ' '), valor, id);
                            }
                        });

                        contenedor.style.display = 'flex';
                        gaugesVisible = true;
                    });
            }
        }

        // === Cargar gráfico principal ===
        fetch('ohlc.csv')
            .then(response => response.text())
            .then(text => {
                const rows = text.trim().split('\n');
                const headers = rows[0].split(',');
                const data = rows.slice(1).map(r => r.split(','));

                const datetime = [];
                const open = [], high = [], low = [], close = [];

                data.forEach(row => {
                    datetime.push(row[0]);
                    open.push(parseFloat(row[1]));
                    high.push(parseFloat(row[2]));
                    low.push(parseFloat(row[3]));
                    close.push(parseFloat(row[4]));
                });

                const trace = {
                    x: datetime,
                    open: open,
                    high: high,
                    low: low,
                    close: close,
                    type: 'candlestick',
                    name: 'VOO',
                    increasing: { line: { color: 'green' } },
                    decreasing: { line: { color: 'red' } }
                };

                const layout = {
                    title: 'Simulación Dinámica VOO',
                    xaxis: { rangeslider: { visible: false }, title: 'Tiempo' },
                    yaxis: { title: 'Precio' }
                };

                Plotly.newPlot('chart', [trace], layout);
            });
    </script>
</body>
</html>