<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visualización VOO - Candlestick</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>VOO ETF - Gráfico de Velas con Indicadores</h2>
  <div id="chart" style="width:100%;height:600px;"></div>

  <script>
    async function drawChart() {
      const response = await fetch('ohlc.csv');
      const text = await response.text();
      const rows = text.trim().split('\n').slice(1);
      const data = rows.map(r => r.split(','));

      const times = data.map(r => r[0]);
      const open = data.map(r => parseFloat(r[1]));
      const high = data.map(r => parseFloat(r[2]));
      const low = data.map(r => parseFloat(r[3]));
      const close = data.map(r => parseFloat(r[4]));
      const rsi = data.map(r => r[5]);
      const macd = data.map(r => r[6]);
      const signal = data.map(r => r[7]);

      const candlestick = {
        x: times,
        open: open,
        high: high,
        low: low,
        close: close,
        type: 'candlestick',
        name: 'VOO',
        increasing: { line: { color: 'green' } },
        decreasing: { line: { color: 'red' } },
        xaxis: 'x',
        yaxis: 'y',
      };

      const rsi_trace = {
        x: times,
        y: rsi,
        type: 'scatter',
        mode: 'lines',
        name: 'RSI',
        yaxis: 'y2'
      };

      const macd_trace = {
        x: times,
        y: macd,
        type: 'scatter',
        mode: 'lines',
        name: 'MACD',
        yaxis: 'y3'
      };

      const layout = {
        title: 'VOO - Candlestick con Indicadores',
        xaxis: { domain: [0, 1], anchor: 'y' },
        yaxis: { domain: [0.5, 1], title: 'Precio' },
        yaxis2: { domain: [0.25, 0.5], title: 'RSI', anchor: 'x' },
        yaxis3: { domain: [0, 0.25], title: 'MACD', anchor: 'x' },
        height: 800,
        showlegend: true
      };

      Plotly.newPlot('chart', [candlestick, rsi_trace, macd_trace], layout);
    }

    drawChart();
  </script>
</body>
</html>